# Lebedev-shop

## Высоконагруженные отказоустойчивые сервисы и NoSQL
* Лекция 1. Концепция NoSQL. Распределенные хранилища данных. Хранилище HBase (слайды, видео)
* Лекция 2. Хранилище пар ключ-значение Redis (слайды, видео)
* Лекция 3. Столбцово-ориентированное хранилище Cassandra (слайды, видео)
* Лекция 4. Столбцово-ориентированное хранилище ClickHouse OpenSource (слайды, видео)
* Лекция 5. Документоориентированное хранилище MongoDB (слайды, видео)
* Лекция 6. Поисковая система Elasticsearch (слайды, видео)

### Лабораторная работа. Рекомендуется выполнять 6-8 студентам.

Разработать упрощенную минималистичную базу данных интернет-магазина для поддержки каталога с товарами, корзин, заказов (набор атрибутов на усмотрение студента).
Специфицировать операции create/read/update/delete для товаров, корзин, заказов в виде HTTP-запросов (задание параметров и методов запросов на усмотрение студента).
Материализовать базу данных в PostgreSQL, а веб-сервис на любом языке программирования с применением любых средств на усмотрение студента. Никакого Frontend не предполагается. Плагины, такие как Postman (https://chrome.google.com/webstore/detail/postman-interceptor/aicmkgpgakddgnaphhhpliifpcfhicfo?hl=ru) могут помочь в отладке запросов. Два минималистичных и быстрых решения:
Java Servlet на Apache Tomcat (https://coderlessons.com/tutorials/java-tekhnologii/uchit-servlety/servlety-kratkoe-rukovodstvo)
Простой HTTP сервер на Python (https://python-course.readthedocs.io/projects/year2/en/latest/lessons/07-simple-http-server.html)
Настроить мультимастер-репликацию БД с помощью pgpool-II. Количество экземпляров backend не менее двух.
Краткие теоретические сведения из документации PostgreSQL: https://www.postgresql.org/docs/current/different-replication-solutions.html
Промежуточное ПО: https://www.pgpool.net/mediawiki/index.php/Main_Page
Продублируйте настроенный экземпляр pgpool-II. Запрограммируйте в веб-приложении круговую смену backend для балансировки нагрузки и переподключения в случае сбоя части экземпляров. В качестве backend настраивается не экземпляр PostgreSQL, а экземпляр pgpool-II.
Разверните еще один экземпляр веб-сервиса и настройте балансировку нагрузки с помощью nginx.
В случае выбора Tomcat (поддерживаются липкие сессии, ищите на странице sticky sessions): https://docs.nginx.com/nginx/deployment-guides/load-balance-third-party/apache-tomcat/
В общем случае:  http://nginx.org/en/docs/http/load_balancing.html#nginx_load_balancing_methods
Продублируйте экземпляр nginx. 
Подготовьте клиент нагрузочного тестирования например, на python + requests, который будет имитировать поведение посетителя-шопоголика. Реализуйте круговую смену backend (nginx). Зафиксируйте среднее время выполнения различных запросов из специфицированного в п. 2 API. Сделайте замеры для различного количества экземпляров PostgreSQL, pgpool-II, веб-сервиса и nginx. Оцените влияние количества экземпляров компонентов на время выполнения операций чтения и записи. Постройте графики среднего времени выполнения каждого запроса для каждой конфигурации. Можно оформить в виде нескольких barchart.
Перенесите часть функциональности, например операции над корзиной, в redis. Предположение: модель пользователя-шопоголика подразумевает “муки выбора” и частое изменение корзины.
https://github.com/redisson/redisson#Downloads
pip3 install redis 
Настройте репликацию в redis. Сделайте доработки, аналогичные п. 5. По умолчанию реплики - read only, можете ограничиться балансировкой запросов чтения.
Вновь выполните нагрузочное тестирование и перестройте графики.
Перенесите часть функциональности, например, каталог товаров, в cassandra.
https://cassandra.apache.org/doc/latest/cassandra/getting_started/drivers.html
Настройте кластер cassandra из 3 узлов. Сделайте доработки, аналогичные п. 5. Вы можете поддерживать строгий уровень согласованности на операциях чтения и записи. https://ru.bmstu.wiki/Apache_Cassandra
Вновь выполните нагрузочное тестирование и перестройте графики.

* Рекомендации к отладочному окружению: запуск различных экземпляров ПО на разных портах в одной ОС, без контейнеризации и виртуализации.
* Рекомендации к нагрузочному тестированию: многомашинные (многоноутбучные) конфигурации с контейнеризацией/виртуализацией/просто ручным запуском. Клиент нагрузочного тестирования должен быть запущен во множестве экземпляров. Вам может оказаться полезным:
* На занятиях: витая пара и режимы hot spot wifi-адаптеров в ноутбуках для организации сети (телефоны как роутеры могут серьезно ограничить packets per second и не дать собрать статистику).
Port-Forwarding домой.
Ресурсы серверной.

### Критерии оценки:
* тройка - графики с PostgreSQL
* четверка - графики с PostgreSQL, Redis
* пятерка - графики с PostgreSQL, Redis, Cassandra
